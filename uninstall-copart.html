<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Выход из аккаунтов</title>
</head>
<body>
    <h1>Выполняем выход из аккаунтов...</h1>
    <p>Пожалуйста, подождите. Мы завершаем ваши сессии на Copart и IAAI.</p>
    <p>Этот процесс займёт несколько секунд.</p>

    <script>
      (function () {
        const START_DELAY_MS = 4000;            // ⬅️ пауза в начале, чтобы успеть сбросить кеш
        const COPART_URL     = "https://www.copart.ca/logout";
        const IAAI_URL       = "https://ca.iaai.com/account/logoff";

        let armed = false; // защищаемся от onload на about:blank

        // Вызывается из onload/onerror iframe:
        window.redirectToCopartWithDelay = function () {
          if (!armed) return; // игнорируем ранний onload до старта

          // Открываем Copart через window (не прерывая текущую страницу)
          let w = null;
          try { w = window.open(COPART_URL, "_blank", "noopener,noreferrer"); } catch (e) {}

          // Если попап заблокирован — даём IAAI ещё 8с и уходим в этом окне
          if (!w) setTimeout(function () { window.open(COPART_URL, "_self"); }, 8000);
        };

        // Стартуем после паузы
        setTimeout(function () {
          armed = true;

          // Хард-фолбэк: если от IAAI нет ответа вообще — всё равно уйдём на Copart
          setTimeout(function () { window.open(COPART_URL, "_self"); }, 15000);

          // Запускаем загрузку IAAI (только теперь)
          const f = document.getElementById("iaaiFrame");
          if (f) f.src = IAAI_URL;
        }, START_DELAY_MS);
      })();
    </script>

    <!-- IAAI — по умолчанию about:blank, чтобы не стартовал до паузы -->
    <iframe id="iaaiFrame"
            style="display:none;"
            src="about:blank"
            onload="redirectToCopartWithDelay()"
            onerror="redirectToCopartWithDelay()"></iframe>
</body>
</html>
